import{r as f,j as W}from"./react-BdCubYHz.js";import{a as sn,m as St,O as Ze,n as Je,S as Rt,o as Ae,p as an,q as cn,r as ln,b as un,l as Ot,s as fn,A as dn,t as mt,u as pn,R as vn,g as mn,v as Ke,V as Y,w as hn,x as gn,y as bn,z as yn,E as ye,W as wn,H as Tt,L as ht,G as En,F as xn,J as jn,K as Cn,Q as Pn,X as Mn}from"./three-Dlbs-qyx.js";import{j as Sn}from"./react-use-measure-DvzsJVfN.js";import{c as Rn,x as On,i as Tn,m as kn}from"./its-fine-UdzVbGov.js";import{c as je,R as _n}from"./react-reconciler-C_iaNTue.js";import{s as gt}from"./scheduler-DV1PgV85.js";import{_ as Te}from"./@babel-CF3RwP-h.js";import{c as In}from"./react-dom-DROicfU5.js";import{c as kt,a as Ln}from"./zustand-JvyHyJda.js";import{G as Qe,D as An,M as Fe,O as Fn,R as Dn,E as zn,a as Hn}from"./three-stdlib-BpduEzU0.js";import{H as Wn,G as Bn}from"./@monogrid-7l7o_qaB.js";import{s as Gn,p as Nn,c as $n}from"./suspend-react-BKIKQNXN.js";function _t(e){let t=e.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const It=e=>e&&e.isOrthographicCamera,qn=e=>e&&e.hasOwnProperty("current"),Un=e=>e!=null&&(typeof e=="string"||typeof e=="number"||e.isColor),he=((e,t)=>typeof window<"u"&&(((e=window.document)==null?void 0:e.createElement)||((t=window.navigator)==null?void 0:t.product)==="ReactNative"))()?f.useLayoutEffect:f.useEffect;function et(e){const t=f.useRef(e);return he(()=>void(t.current=e),[e]),t}function Vn(){const e=Rn(),t=On();return f.useMemo(()=>({children:n})=>{const o=!!Tn(e,!0,s=>s.type===f.StrictMode)?f.StrictMode:f.Fragment;return W.jsx(o,{children:W.jsx(t,{children:n})})},[e,t])}function Xn({set:e}){return he(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}const Yn=(e=>(e=class extends f.Component{constructor(...n){super(...n),this.state={error:!1}}componentDidCatch(n){this.props.set(n)}render(){return this.state.error?null:this.props.children}},e.getDerivedStateFromError=()=>({error:!0}),e))();function Lt(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}function oe(e){var t;return(t=e.__r3f)==null?void 0:t.root.getState()}const L={obj:e=>e===Object(e)&&!L.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,nul:e=>e===null,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:r="reference",strict:o=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(L.str(e)||L.num(e)||L.boo(e))return e===t;const s=L.obj(e);if(s&&r==="reference")return e===t;const a=L.arr(e);if(a&&n==="reference")return e===t;if((a||s)&&e===t)return!0;let u;for(u in e)if(!(u in t))return!1;if(s&&n==="shallow"&&r==="shallow"){for(u in o?t:e)if(!L.equ(e[u],t[u],{strict:o,objects:"reference"}))return!1}else for(u in o?t:e)if(e[u]!==t[u])return!1;if(L.und(u)){if(a&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Zn(e){const t={nodes:{},materials:{},meshes:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material),n.isMesh&&!t.meshes[n.name]&&(t.meshes[n.name]=n)}),t}function Jn(e){e.type!=="Scene"&&(e.dispose==null||e.dispose());for(const t in e){const n=e[t];n?.type!=="Scene"&&(n==null||n.dispose==null||n.dispose())}}const At=["children","key","ref"];function Kn(e){const t={};for(const n in e)At.includes(n)||(t[n]=e[n]);return t}function Pe(e,t,n,r){const o=e;let s=o?.__r3f;return s||(s={root:t,type:n,parent:null,children:[],props:Kn(r),object:o,eventCount:0,handlers:{},isHidden:!1},o&&(o.__r3f=s)),s}function ve(e,t){let n=e[t];if(!t.includes("-"))return{root:e,key:t,target:n};n=e;for(const o of t.split("-")){var r;t=o,e=n,n=(r=n)==null?void 0:r[t]}return{root:e,key:t,target:n}}const bt=/-\d+$/;function Me(e,t){if(L.str(t.props.attach)){if(bt.test(t.props.attach)){const o=t.props.attach.replace(bt,""),{root:s,key:a}=ve(e.object,o);Array.isArray(s[a])||(s[a]=[])}const{root:n,key:r}=ve(e.object,t.props.attach);t.previousAttach=n[r],n[r]=t.object}else L.fun(t.props.attach)&&(t.previousAttach=t.props.attach(e.object,t.object))}function Se(e,t){if(L.str(t.props.attach)){const{root:n,key:r}=ve(e.object,t.props.attach),o=t.previousAttach;o===void 0?delete n[r]:n[r]=o}else t.previousAttach==null||t.previousAttach(e.object,t.object);delete t.previousAttach}const $e=[...At,"args","dispose","attach","object","onUpdate","dispose"],yt=new Map;function Qn(e){let t=yt.get(e.constructor);try{t||(t=new e.constructor,yt.set(e.constructor,t))}catch{}return t}function er(e,t){const n={};for(const r in t)if(!$e.includes(r)&&!L.equ(t[r],e.props[r])){n[r]=t[r];for(const o in t)o.startsWith(`${r}-`)&&(n[o]=t[o])}for(const r in e.props){if($e.includes(r)||t.hasOwnProperty(r))continue;const{root:o,key:s}=ve(e.object,r);if(o.constructor&&o.constructor.length===0){const a=Qn(o);L.und(a)||(n[s]=a[s])}else n[s]=0}return n}const tr=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],nr=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function U(e,t){var n;const r=e.__r3f,o=r&&_t(r).getState(),s=r?.eventCount;for(const u in t){let i=t[u];if($e.includes(u))continue;if(r&&nr.test(u)){typeof i=="function"?r.handlers[u]=i:delete r.handlers[u],r.eventCount=Object.keys(r.handlers).length;continue}if(i===void 0)continue;let{root:p,key:c,target:l}=ve(e,u);if(l instanceof mt&&i instanceof mt)l.mask=i.mask;else if(l instanceof pn&&Un(i))l.set(i);else if(l!==null&&typeof l=="object"&&typeof l.set=="function"&&typeof l.copy=="function"&&i!=null&&i.constructor&&l.constructor===i.constructor)l.copy(i);else if(l!==null&&typeof l=="object"&&typeof l.set=="function"&&Array.isArray(i))typeof l.fromArray=="function"?l.fromArray(i):l.set(...i);else if(l!==null&&typeof l=="object"&&typeof l.set=="function"&&typeof i=="number")typeof l.setScalar=="function"?l.setScalar(i):l.set(i);else{var a;p[c]=i,o&&!o.linear&&tr.includes(c)&&(a=p[c])!=null&&a.isTexture&&p[c].format===vn&&p[c].type===mn&&(p[c].colorSpace=Ot)}}if(r!=null&&r.parent&&o!=null&&o.internal&&(n=r.object)!=null&&n.isObject3D&&s!==r.eventCount){const u=r.object,i=o.internal.interaction.indexOf(u);i>-1&&o.internal.interaction.splice(i,1),r.eventCount&&u.raycast!==null&&o.internal.interaction.push(u)}return r&&r.props.attach===void 0&&(r.object.isBufferGeometry?r.props.attach="geometry":r.object.isMaterial&&(r.props.attach="material")),r&&le(r),e}function le(e){var t;if(!e.parent)return;e.props.onUpdate==null||e.props.onUpdate(e.object);const n=(t=e.root)==null||t.getState==null?void 0:t.getState();n&&n.internal.frames===0&&n.invalidate()}function Ft(e,t){e.manual||(It(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix())}const B=e=>e?.isObject3D;function we(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Dt(e,t,n,r){const o=n.get(t);o&&(n.delete(t),n.size===0&&(e.delete(r),o.target.releasePointerCapture(r)))}function rr(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(r=>r!==t),n.initialHits=n.initialHits.filter(r=>r!==t),n.hovered.forEach((r,o)=>{(r.eventObject===t||r.object===t)&&n.hovered.delete(o)}),n.capturedMap.forEach((r,o)=>{Dt(n.capturedMap,t,r,o)})}function or(e){function t(i){const{internal:p}=e.getState(),c=i.offsetX-p.initialClick[0],l=i.offsetY-p.initialClick[1];return Math.round(Math.sqrt(c*c+l*l))}function n(i){return i.filter(p=>["Move","Over","Enter","Out","Leave"].some(c=>{var l;return(l=p.__r3f)==null?void 0:l.handlers["onPointer"+c]}))}function r(i,p){const c=e.getState(),l=new Set,m=[],v=p?p(c.internal.interaction):c.internal.interaction;for(let h=0;h<v.length;h++){const d=oe(v[h]);d&&(d.raycaster.camera=void 0)}c.previousRoot||c.events.compute==null||c.events.compute(i,c);function E(h){const d=oe(h);if(!d||!d.events.enabled||d.raycaster.camera===null)return[];if(d.raycaster.camera===void 0){var x;d.events.compute==null||d.events.compute(i,d,(x=d.previousRoot)==null?void 0:x.getState()),d.raycaster.camera===void 0&&(d.raycaster.camera=null)}return d.raycaster.camera?d.raycaster.intersectObject(h,!0):[]}let S=v.flatMap(E).sort((h,d)=>{const x=oe(h.object),j=oe(d.object);return!x||!j?h.distance-d.distance:j.events.priority-x.events.priority||h.distance-d.distance}).filter(h=>{const d=we(h);return l.has(d)?!1:(l.add(d),!0)});c.events.filter&&(S=c.events.filter(S,c));for(const h of S){let d=h.object;for(;d;){var w;(w=d.__r3f)!=null&&w.eventCount&&m.push({...h,eventObject:d}),d=d.parent}}if("pointerId"in i&&c.internal.capturedMap.has(i.pointerId))for(let h of c.internal.capturedMap.get(i.pointerId).values())l.has(we(h.intersection))||m.push(h.intersection);return m}function o(i,p,c,l){if(i.length){const m={stopped:!1};for(const v of i){let E=oe(v.object);if(E||v.object.traverseAncestors(S=>{const w=oe(S);if(w)return E=w,!1}),E){const{raycaster:S,pointer:w,camera:h,internal:d}=E,x=new Y(w.x,w.y,0).unproject(h),j=y=>{var k,C;return(k=(C=d.capturedMap.get(y))==null?void 0:C.has(v.eventObject))!=null?k:!1},b=y=>{const k={intersection:v,target:p.target};d.capturedMap.has(y)?d.capturedMap.get(y).set(v.eventObject,k):d.capturedMap.set(y,new Map([[v.eventObject,k]])),p.target.setPointerCapture(y)},g=y=>{const k=d.capturedMap.get(y);k&&Dt(d.capturedMap,v.eventObject,k,y)};let T={};for(let y in p){let k=p[y];typeof k!="function"&&(T[y]=k)}let M={...v,...T,pointer:w,intersections:i,stopped:m.stopped,delta:c,unprojectedPoint:x,ray:S.ray,camera:h,stopPropagation(){const y="pointerId"in p&&d.capturedMap.get(p.pointerId);if((!y||y.has(v.eventObject))&&(M.stopped=m.stopped=!0,d.hovered.size&&Array.from(d.hovered.values()).find(k=>k.eventObject===v.eventObject))){const k=i.slice(0,i.indexOf(v));s([...k,v])}},target:{hasPointerCapture:j,setPointerCapture:b,releasePointerCapture:g},currentTarget:{hasPointerCapture:j,setPointerCapture:b,releasePointerCapture:g},nativeEvent:p};if(l(M),m.stopped===!0)break}}}return i}function s(i){const{internal:p}=e.getState();for(const c of p.hovered.values())if(!i.length||!i.find(l=>l.object===c.object&&l.index===c.index&&l.instanceId===c.instanceId)){const m=c.eventObject.__r3f;if(p.hovered.delete(we(c)),m!=null&&m.eventCount){const v=m.handlers,E={...c,intersections:i};v.onPointerOut==null||v.onPointerOut(E),v.onPointerLeave==null||v.onPointerLeave(E)}}}function a(i,p){for(let c=0;c<p.length;c++){const l=p[c].__r3f;l==null||l.handlers.onPointerMissed==null||l.handlers.onPointerMissed(i)}}function u(i){switch(i){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return p=>{const{internal:c}=e.getState();"pointerId"in p&&c.capturedMap.has(p.pointerId)&&requestAnimationFrame(()=>{c.capturedMap.has(p.pointerId)&&(c.capturedMap.delete(p.pointerId),s([]))})}}return function(c){const{onPointerMissed:l,internal:m}=e.getState();m.lastEvent.current=c;const v=i==="onPointerMove",E=i==="onClick"||i==="onContextMenu"||i==="onDoubleClick",w=r(c,v?n:void 0),h=E?t(c):0;i==="onPointerDown"&&(m.initialClick=[c.offsetX,c.offsetY],m.initialHits=w.map(x=>x.eventObject)),E&&!w.length&&h<=2&&(a(c,m.interaction),l&&l(c)),v&&s(w);function d(x){const j=x.eventObject,b=j.__r3f;if(!(b!=null&&b.eventCount))return;const g=b.handlers;if(v){if(g.onPointerOver||g.onPointerEnter||g.onPointerOut||g.onPointerLeave){const T=we(x),M=m.hovered.get(T);M?M.stopped&&x.stopPropagation():(m.hovered.set(T,x),g.onPointerOver==null||g.onPointerOver(x),g.onPointerEnter==null||g.onPointerEnter(x))}g.onPointerMove==null||g.onPointerMove(x)}else{const T=g[i];T?(!E||m.initialHits.includes(j))&&(a(c,m.interaction.filter(M=>!m.initialHits.includes(M))),T(x)):E&&m.initialHits.includes(j)&&a(c,m.interaction.filter(M=>!m.initialHits.includes(M)))}}o(w,c,h,d)}}return{handlePointer:u}}const wt=e=>!!(e!=null&&e.render),tt=f.createContext(null),ir=(e,t)=>{const n=kt((u,i)=>{const p=new Y,c=new Y,l=new Y;function m(h=i().camera,d=c,x=i().size){const{width:j,height:b,top:g,left:T}=x,M=j/b;d.isVector3?l.copy(d):l.set(...d);const y=h.getWorldPosition(p).distanceTo(l);if(It(h))return{width:j/h.zoom,height:b/h.zoom,top:g,left:T,factor:1,distance:y,aspect:M};{const k=h.fov*Math.PI/180,C=2*Math.tan(k/2)*y,V=C*(j/b);return{width:V,height:C,top:g,left:T,factor:j/V,distance:y,aspect:M}}}let v;const E=h=>u(d=>({performance:{...d.performance,current:h}})),S=new Ke;return{set:u,get:i,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(h=1)=>e(i(),h),advance:(h,d)=>t(h,d,i()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new hn,pointer:S,mouse:S,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const h=i();v&&clearTimeout(v),h.performance.current!==h.performance.min&&E(h.performance.min),v=setTimeout(()=>E(i().performance.max),h.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:m},setEvents:h=>u(d=>({...d,events:{...d.events,...h}})),setSize:(h,d,x=0,j=0)=>{const b=i().camera,g={width:h,height:d,top:x,left:j};u(T=>({size:g,viewport:{...T.viewport,...m(b,c,g)}}))},setDpr:h=>u(d=>{const x=Lt(h);return{viewport:{...d.viewport,dpr:x,initialDpr:d.viewport.initialDpr||x}}}),setFrameloop:(h="always")=>{const d=i().clock;d.stop(),d.elapsedTime=0,h!=="never"&&(d.start(),d.elapsedTime=0),u(()=>({frameloop:h}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:f.createRef(),active:!1,frames:0,priority:0,subscribe:(h,d,x)=>{const j=i().internal;return j.priority=j.priority+(d>0?1:0),j.subscribers.push({ref:h,priority:d,store:x}),j.subscribers=j.subscribers.sort((b,g)=>b.priority-g.priority),()=>{const b=i().internal;b!=null&&b.subscribers&&(b.priority=b.priority-(d>0?1:0),b.subscribers=b.subscribers.filter(g=>g.ref!==h))}}}}}),r=n.getState();let o=r.size,s=r.viewport.dpr,a=r.camera;return n.subscribe(()=>{const{camera:u,size:i,viewport:p,gl:c,set:l}=n.getState();if(i.width!==o.width||i.height!==o.height||p.dpr!==s){o=i,s=p.dpr,Ft(u,i),p.dpr>0&&c.setPixelRatio(p.dpr);const m=typeof HTMLCanvasElement<"u"&&c.domElement instanceof HTMLCanvasElement;c.setSize(i.width,i.height,m)}u!==a&&(a=u,l(m=>({viewport:{...m.viewport,...m.viewport.getCurrentViewport(u)}})))}),n.subscribe(u=>e(u)),n};function nt(){const e=f.useContext(tt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function H(e=n=>n,t){return nt()(e,t)}function ke(e,t=0){const n=nt(),r=n.getState().internal.subscribe,o=et(e);return he(()=>r(o,t,n),[t,r,n]),null}const Et=new WeakMap,sr=e=>{var t;return typeof e=="function"&&(e==null||(t=e.prototype)==null?void 0:t.constructor)===e};function zt(e,t){return function(n,...r){let o;return sr(n)?(o=Et.get(n),o||(o=new n,Et.set(n,o))):o=n,e&&e(o),Promise.all(r.map(s=>new Promise((a,u)=>o.load(s,i=>{B(i?.scene)&&Object.assign(i,Zn(i.scene)),a(i)},t,i=>u(new Error(`Could not load ${s}: ${i?.message}`))))))}}function Z(e,t,n,r){const o=Array.isArray(t)?t:[t],s=Gn(zt(n,r),[e,...o],{equal:L.equ});return Array.isArray(t)?s:s[0]}Z.preload=function(e,t,n){const r=Array.isArray(t)?t:[t];return Nn(zt(n),[e,...r])};Z.clear=function(e,t){const n=Array.isArray(t)?t:[t];return $n([e,...n])};function ar(e){const t=_n(e);return t.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:f.version}),t}const Ht=0,ce={},cr=/^three(?=[A-Z])/,_e=e=>`${e[0].toUpperCase()}${e.slice(1)}`;let lr=0;const ur=e=>typeof e=="function";function Wt(e){if(ur(e)){const t=`${lr++}`;return ce[t]=e,t}else Object.assign(ce,e)}function Bt(e,t){const n=_e(e),r=ce[n];if(e!=="primitive"&&!r)throw new Error(`R3F: ${n} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(e==="primitive"&&!t.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(t.args!==void 0&&!Array.isArray(t.args))throw new Error("R3F: The args prop must be an array!")}function fr(e,t,n){var r;return e=_e(e)in ce?e:e.replace(cr,""),Bt(e,t),e==="primitive"&&(r=t.object)!=null&&r.__r3f&&delete t.object.__r3f,Pe(t.object,n,e,t)}function dr(e){if(!e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?Se(e.parent,e):B(e.object)&&(e.object.visible=!1),e.isHidden=!0,le(e)}}function Gt(e){if(e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?Me(e.parent,e):B(e.object)&&e.props.visible!==!1&&(e.object.visible=!0),e.isHidden=!1,le(e)}}function rt(e,t,n){const r=t.root.getState();if(!(!e.parent&&e.object!==r.scene)){if(!t.object){var o,s;const a=ce[_e(t.type)];t.object=(o=t.props.object)!=null?o:new a(...(s=t.props.args)!=null?s:[]),t.object.__r3f=t}if(U(t.object,t.props),t.props.attach)Me(e,t);else if(B(t.object)&&B(e.object)){const a=e.object.children.indexOf(n?.object);if(n&&a!==-1){const u=e.object.children.indexOf(t.object);if(u!==-1){e.object.children.splice(u,1);const i=u<a?a-1:a;e.object.children.splice(i,0,t.object)}else t.object.parent=e.object,e.object.children.splice(a,0,t.object),t.object.dispatchEvent({type:"added"}),e.object.dispatchEvent({type:"childadded",child:t.object})}else e.object.add(t.object)}for(const a of t.children)rt(t,a);le(t)}}function De(e,t){t&&(t.parent=e,e.children.push(t),rt(e,t))}function xt(e,t,n){if(!t||!n)return;t.parent=e;const r=e.children.indexOf(n);r!==-1?e.children.splice(r,0,t):e.children.push(t),rt(e,t,n)}function Nt(e){if(typeof e.dispose=="function"){const t=()=>{try{e.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?t():gt.unstable_scheduleCallback(gt.unstable_IdlePriority,t)}}function qe(e,t,n){if(!t)return;t.parent=null;const r=e.children.indexOf(t);r!==-1&&e.children.splice(r,1),t.props.attach?Se(e,t):B(t.object)&&B(e.object)&&(e.object.remove(t.object),rr(_t(t),t.object));const o=t.props.dispose!==null&&n!==!1;for(let s=t.children.length-1;s>=0;s--){const a=t.children[s];qe(t,a,o)}t.children.length=0,delete t.object.__r3f,o&&t.type!=="primitive"&&t.object.type!=="Scene"&&Nt(t.object),n===void 0&&le(t)}function pr(e,t){for(const n of[e,e.alternate])if(n!==null)if(typeof n.ref=="function"){n.refCleanup==null||n.refCleanup();const r=n.ref(t);typeof r=="function"&&(n.refCleanup=r)}else n.ref&&(n.ref.current=t)}const Ce=[];function vr(){for(const[n]of Ce){const r=n.parent;if(r){n.props.attach?Se(r,n):B(n.object)&&B(r.object)&&r.object.remove(n.object);for(const o of n.children)o.props.attach?Se(n,o):B(o.object)&&B(n.object)&&n.object.remove(o.object)}n.isHidden&&Gt(n),n.object.__r3f&&delete n.object.__r3f,n.type!=="primitive"&&Nt(n.object)}for(const[n,r,o]of Ce){n.props=r;const s=n.parent;if(s){var e,t;const a=ce[_e(n.type)];n.object=(e=n.props.object)!=null?e:new a(...(t=n.props.args)!=null?t:[]),n.object.__r3f=n,pr(o,n.object),U(n.object,n.props),n.props.attach?Me(s,n):B(n.object)&&B(s.object)&&s.object.add(n.object);for(const u of n.children)u.props.attach?Me(n,u):B(u.object)&&B(n.object)&&n.object.add(u.object);le(n)}}Ce.length=0}const ze=()=>{},jt={};let Ee=Ht;const mr=0,hr=4,Re=ar({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:fr,removeChild:qe,appendChild:De,appendInitialChild:De,insertBefore:xt,appendChildToContainer(e,t){const n=e.getState().scene.__r3f;!t||!n||De(n,t)},removeChildFromContainer(e,t){const n=e.getState().scene.__r3f;!t||!n||qe(n,t)},insertInContainerBefore(e,t,n){const r=e.getState().scene.__r3f;!t||!n||!r||xt(r,t,n)},getRootHostContext:()=>jt,getChildHostContext:()=>jt,commitUpdate(e,t,n,r,o){var s,a,u;Bt(t,r);let i=!1;if((e.type==="primitive"&&n.object!==r.object||((s=r.args)==null?void 0:s.length)!==((a=n.args)==null?void 0:a.length)||(u=r.args)!=null&&u.some((c,l)=>{var m;return c!==((m=n.args)==null?void 0:m[l])}))&&(i=!0),i)Ce.push([e,{...r},o]);else{const c=er(e,r);Object.keys(c).length&&(Object.assign(e.props,c),U(e.object,c))}(o.sibling===null||(o.flags&hr)===mr)&&vr()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:e=>e?.object,prepareForCommit:()=>null,preparePortalMount:e=>Pe(e.getState().scene,e,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:dr,unhideInstance:Gt,createTextInstance:ze,hideTextInstance:ze,unhideTextInstance:ze,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:f.createContext(null),setCurrentUpdatePriority(e){Ee=e},getCurrentUpdatePriority(){return Ee},resolveUpdatePriority(){var e;if(Ee!==Ht)return Ee;switch(typeof window<"u"&&((e=window.event)==null?void 0:e.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return je.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return je.ContinuousEventPriority;default:return je.DefaultEventPriority}},resetFormInstance(){}}),ne=new Map,ie={objects:"shallow",strict:!1};function gr(e,t){if(!t&&typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:n,height:r,top:o,left:s}=e.parentElement.getBoundingClientRect();return{width:n,height:r,top:o,left:s}}else if(!t&&typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...t}}function br(e){const t=ne.get(e),n=t?.fiber,r=t?.store;t&&console.warn("R3F.createRoot should only be called once!");const o=typeof reportError=="function"?reportError:console.error,s=r||ir(Xe,Pt),a=n||Re.createContainer(s,je.ConcurrentRoot,null,!1,null,"",o,o,o,null);t||ne.set(e,{fiber:a,store:s});let u,i,p=!1,c=null;return{async configure(l={}){let m;c=new Promise(R=>m=R);let{gl:v,size:E,scene:S,events:w,onCreated:h,shadows:d=!1,linear:x=!1,flat:j=!1,legacy:b=!1,orthographic:g=!1,frameloop:T="always",dpr:M=[1,2],performance:y,raycaster:k,camera:C,onPointerMissed:V}=l,P=s.getState(),A=P.gl;if(!P.gl){const R={canvas:e,powerPreference:"high-performance",antialias:!0,alpha:!0},O=typeof v=="function"?await v(R):v;wt(O)?A=O:A=new sn({...R,...v}),P.set({gl:A})}let _=P.raycaster;_||P.set({raycaster:_=new St});const{params:J,...D}=k||{};if(L.equ(D,_,ie)||U(_,{...D}),L.equ(J,_.params,ie)||U(_,{params:{..._.params,...J}}),!P.camera||P.camera===i&&!L.equ(i,C,ie)){i=C;const R=C?.isCamera,O=R?C:g?new Ze(0,0,0,0,.1,1e3):new Je(75,0,.1,1e3);R||(O.position.z=5,C&&(U(O,C),O.manual||("aspect"in C||"left"in C||"right"in C||"bottom"in C||"top"in C)&&(O.manual=!0,O.updateProjectionMatrix())),!P.camera&&!(C!=null&&C.rotation)&&O.lookAt(0,0,0)),P.set({camera:O}),_.camera=O}if(!P.scene){let R;S!=null&&S.isScene?(R=S,Pe(R,s,"",{})):(R=new Rt,Pe(R,s,"",{}),S&&U(R,S)),P.set({scene:R})}w&&!P.events.handlers&&P.set({events:w(s)});const $=gr(e,E);if(L.equ($,P.size,ie)||P.setSize($.width,$.height,$.top,$.left),M&&P.viewport.dpr!==Lt(M)&&P.setDpr(M),P.frameloop!==T&&P.setFrameloop(T),P.onPointerMissed||P.set({onPointerMissed:V}),y&&!L.equ(y,P.performance,ie)&&P.set(R=>({performance:{...R.performance,...y}})),!P.xr){var G;const R=(F,K)=>{const ue=s.getState();ue.frameloop!=="never"&&Pt(F,!0,ue,K)},O=()=>{const F=s.getState();F.gl.xr.enabled=F.gl.xr.isPresenting,F.gl.xr.setAnimationLoop(F.gl.xr.isPresenting?R:null),F.gl.xr.isPresenting||Xe(F)},z={connect(){const F=s.getState().gl;F.xr.addEventListener("sessionstart",O),F.xr.addEventListener("sessionend",O)},disconnect(){const F=s.getState().gl;F.xr.removeEventListener("sessionstart",O),F.xr.removeEventListener("sessionend",O)}};typeof((G=A.xr)==null?void 0:G.addEventListener)=="function"&&z.connect(),P.set({xr:z})}if(A.shadowMap){const R=A.shadowMap.enabled,O=A.shadowMap.type;if(A.shadowMap.enabled=!!d,L.boo(d))A.shadowMap.type=Ae;else if(L.str(d)){var q;const z={basic:ln,percentage:cn,soft:Ae,variance:an};A.shadowMap.type=(q=z[d])!=null?q:Ae}else L.obj(d)&&Object.assign(A.shadowMap,d);(R!==A.shadowMap.enabled||O!==A.shadowMap.type)&&(A.shadowMap.needsUpdate=!0)}return gn.enabled=!b,p||(A.outputColorSpace=x?un:Ot,A.toneMapping=j?fn:dn),P.legacy!==b&&P.set(()=>({legacy:b})),P.linear!==x&&P.set(()=>({linear:x})),P.flat!==j&&P.set(()=>({flat:j})),v&&!L.fun(v)&&!wt(v)&&!L.equ(v,A,ie)&&U(A,v),u=h,p=!0,m(),this},render(l){return!p&&!c&&this.configure(),c.then(()=>{Re.updateContainer(W.jsx(yr,{store:s,children:l,onCreated:u,rootElement:e}),a,null,()=>{})}),s},unmount(){$t(e)}}}function yr({store:e,children:t,onCreated:n,rootElement:r}){return he(()=>{const o=e.getState();o.set(s=>({internal:{...s.internal,active:!0}})),n&&n(o),e.getState().events.connected||o.events.connect==null||o.events.connect(r)},[]),W.jsx(tt.Provider,{value:e,children:t})}function $t(e,t){const n=ne.get(e),r=n?.fiber;if(r){const o=n?.store.getState();o&&(o.internal.active=!1),Re.updateContainer(null,r,null,()=>{o&&setTimeout(()=>{try{var s,a,u,i;o.events.disconnect==null||o.events.disconnect(),(s=o.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(u=o.gl)==null||u.forceContextLoss==null||u.forceContextLoss(),(i=o.gl)!=null&&i.xr&&o.xr.disconnect(),Jn(o.scene),ne.delete(e)}catch{}},500)})}}function wr(e,t,n){return W.jsx(Er,{children:e,container:t,state:n})}function Er({state:e={},children:t,container:n}){const{events:r,size:o,...s}=e,a=nt(),[u]=f.useState(()=>new St),[i]=f.useState(()=>new Ke),p=et((l,m)=>{let v;if(m.camera&&o){const E=m.camera;v=l.viewport.getCurrentViewport(E,new Y,o),E!==l.camera&&Ft(E,o)}return{...l,...m,scene:n,raycaster:u,pointer:i,mouse:i,previousRoot:a,events:{...l.events,...m.events,...r},size:{...l.size,...o},viewport:{...l.viewport,...v},setEvents:E=>m.set(S=>({...S,events:{...S.events,...E}}))}}),c=f.useMemo(()=>{const l=kt((v,E)=>({...s,set:v,get:E})),m=v=>l.setState(E=>p.current(v,E));return m(a.getState()),a.subscribe(m),l},[a,n]);return W.jsx(W.Fragment,{children:Re.createPortal(W.jsx(tt.Provider,{value:c,children:t}),c,null)})}const xr=new Set,jr=new Set,Cr=new Set;function He(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function pe(e,t){switch(e){case"before":return He(xr,t);case"after":return He(jr,t);case"tail":return He(Cr,t)}}let We,Be;function Ue(e,t,n){let r=t.clock.getDelta();t.frameloop==="never"&&typeof e=="number"&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),We=t.internal.subscribers;for(let o=0;o<We.length;o++)Be=We[o],Be.ref.current(Be.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}let Oe=!1,Ve=!1,Ge,Ct,se;function qt(e){Ct=requestAnimationFrame(qt),Oe=!0,Ge=0,pe("before",e),Ve=!0;for(const n of ne.values()){var t;se=n.store.getState(),se.internal.active&&(se.frameloop==="always"||se.internal.frames>0)&&!((t=se.gl.xr)!=null&&t.isPresenting)&&(Ge+=Ue(e,se))}if(Ve=!1,pe("after",e),Ge===0)return pe("tail",e),Oe=!1,cancelAnimationFrame(Ct)}function Xe(e,t=1){var n;if(!e)return ne.forEach(r=>Xe(r.store.getState(),t));(n=e.gl.xr)!=null&&n.isPresenting||!e.internal.active||e.frameloop==="never"||(t>1?e.internal.frames=Math.min(60,e.internal.frames+t):Ve?e.internal.frames=2:e.internal.frames=1,Oe||(Oe=!0,requestAnimationFrame(qt)))}function Pt(e,t=!0,n,r){if(t&&pe("before",e),n)Ue(e,n,r);else for(const o of ne.values())Ue(e,o.store.getState());t&&pe("after",e)}const Ne={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Pr(e){const{handlePointer:t}=or(e);return{priority:1,enabled:!0,compute(n,r,o){r.pointer.set(n.offsetX/r.size.width*2-1,-(n.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(Ne).reduce((n,r)=>({...n,[r]:t(r)}),{}),update:()=>{var n;const{events:r,internal:o}=e.getState();(n=o.lastEvent)!=null&&n.current&&r.handlers&&r.handlers.onPointerMove(o.lastEvent.current)},connect:n=>{const{set:r,events:o}=e.getState();if(o.disconnect==null||o.disconnect(),r(s=>({events:{...s.events,connected:n}})),o.handlers)for(const s in o.handlers){const a=o.handlers[s],[u,i]=Ne[s];n.addEventListener(u,a,{passive:i})}},disconnect:()=>{const{set:n,events:r}=e.getState();if(r.connected){if(r.handlers)for(const o in r.handlers){const s=r.handlers[o],[a]=Ne[o];r.connected.removeEventListener(a,s)}n(o=>({events:{...o.events,connected:void 0}}))}}}}function Mr({ref:e,children:t,fallback:n,resize:r,style:o,gl:s,events:a=Pr,eventSource:u,eventPrefix:i,shadows:p,linear:c,flat:l,legacy:m,orthographic:v,frameloop:E,dpr:S,performance:w,raycaster:h,camera:d,scene:x,onPointerMissed:j,onCreated:b,...g}){f.useMemo(()=>Wt(bn),[]);const T=Vn(),[M,y]=Sn({scroll:!0,debounce:{scroll:50,resize:0},...r}),k=f.useRef(null),C=f.useRef(null);f.useImperativeHandle(e,()=>k.current);const V=et(j),[P,A]=f.useState(!1),[_,J]=f.useState(!1);if(P)throw P;if(_)throw _;const D=f.useRef(null);he(()=>{const G=k.current;if(y.width>0&&y.height>0&&G){D.current||(D.current=br(G));async function q(){await D.current.configure({gl:s,scene:x,events:a,shadows:p,linear:c,flat:l,legacy:m,orthographic:v,frameloop:E,dpr:S,performance:w,raycaster:h,camera:d,size:y,onPointerMissed:(...R)=>V.current==null?void 0:V.current(...R),onCreated:R=>{R.events.connect==null||R.events.connect(u?qn(u)?u.current:u:C.current),i&&R.setEvents({compute:(O,z)=>{const F=O[i+"X"],K=O[i+"Y"];z.pointer.set(F/z.size.width*2-1,-(K/z.size.height)*2+1),z.raycaster.setFromCamera(z.pointer,z.camera)}}),b?.(R)}}),D.current.render(W.jsx(T,{children:W.jsx(Yn,{set:J,children:W.jsx(f.Suspense,{fallback:W.jsx(Xn,{set:A}),children:t??null})})}))}q()}}),f.useEffect(()=>{const G=k.current;if(G)return()=>$t(G)},[]);const $=u?"none":"auto";return W.jsx("div",{ref:C,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:$,...o},...g,children:W.jsx("div",{ref:M,style:{width:"100%",height:"100%"},children:W.jsx("canvas",{ref:k,style:{display:"block"},children:n})})})}function ro(e){return W.jsx(kn,{children:W.jsx(Mr,{...e})})}const ge=new Y,ot=new Y,Sr=new Y,Mt=new Ke;function Rr(e,t,n){const r=ge.setFromMatrixPosition(e.matrixWorld);r.project(t);const o=n.width/2,s=n.height/2;return[r.x*o+o,-(r.y*s)+s]}function Or(e,t){const n=ge.setFromMatrixPosition(e.matrixWorld),r=ot.setFromMatrixPosition(t.matrixWorld),o=n.sub(r),s=t.getWorldDirection(Sr);return o.angleTo(s)>Math.PI/2}function Tr(e,t,n,r){const o=ge.setFromMatrixPosition(e.matrixWorld),s=o.clone();s.project(t),Mt.set(s.x,s.y),n.setFromCamera(Mt,t);const a=n.intersectObjects(r,!0);if(a.length){const u=a[0].distance;return o.distanceTo(n.ray.origin)<u}return!0}function kr(e,t){if(t instanceof Ze)return t.zoom;if(t instanceof Je){const n=ge.setFromMatrixPosition(e.matrixWorld),r=ot.setFromMatrixPosition(t.matrixWorld),o=t.fov*Math.PI/180,s=n.distanceTo(r);return 1/(2*Math.tan(o/2)*s)}else return 1}function _r(e,t,n){if(t instanceof Je||t instanceof Ze){const r=ge.setFromMatrixPosition(e.matrixWorld),o=ot.setFromMatrixPosition(t.matrixWorld),s=r.distanceTo(o),a=(n[1]-n[0])/(t.far-t.near),u=n[1]-a*t.far;return Math.round(a*s+u)}}const Ye=e=>Math.abs(e)<1e-10?0:e;function Ut(e,t,n=""){let r="matrix3d(";for(let o=0;o!==16;o++)r+=Ye(t[o]*e.elements[o])+(o!==15?",":")");return n+r}const Ir=(e=>t=>Ut(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Lr=(e=>(t,n)=>Ut(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Ar(e){return e&&typeof e=="object"&&"current"in e}const oo=f.forwardRef(({children:e,eps:t=.001,style:n,className:r,prepend:o,center:s,fullscreen:a,portal:u,distanceFactor:i,sprite:p=!1,transform:c=!1,occlude:l,onOcclude:m,castShadow:v,receiveShadow:E,material:S,geometry:w,zIndexRange:h=[16777271,0],calculatePosition:d=Rr,as:x="div",wrapperClass:j,pointerEvents:b="auto",...g},T)=>{const{gl:M,camera:y,scene:k,size:C,raycaster:V,events:P,viewport:A}=H(),[_]=f.useState(()=>document.createElement(x)),J=f.useRef(null),D=f.useRef(null),$=f.useRef(0),G=f.useRef([0,0]),q=f.useRef(null),R=f.useRef(null),O=u?.current||P.connected||M.domElement.parentNode,z=f.useRef(null),F=f.useRef(!1),K=f.useMemo(()=>l&&l!=="blending"||Array.isArray(l)&&l.length&&Ar(l[0]),[l]);f.useLayoutEffect(()=>{const N=M.domElement;l&&l==="blending"?(N.style.zIndex=`${Math.floor(h[0]/2)}`,N.style.position="absolute",N.style.pointerEvents="none"):(N.style.zIndex=null,N.style.position=null,N.style.pointerEvents=null)},[l]),f.useLayoutEffect(()=>{if(D.current){const N=J.current=In.createRoot(_);if(k.updateMatrixWorld(),c)_.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const I=d(D.current,y,C);_.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${I[0]}px,${I[1]}px,0);transform-origin:0 0;`}return O&&(o?O.prepend(_):O.appendChild(_)),()=>{O&&O.removeChild(_),N.unmount()}}},[O,c]),f.useLayoutEffect(()=>{j&&(_.className=j)},[j]);const ue=f.useMemo(()=>c?{position:"absolute",top:0,left:0,width:C.width,height:C.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...a&&{top:-C.height/2,left:-C.width/2,width:C.width,height:C.height},...n},[n,s,a,C,c]),Jt=f.useMemo(()=>({position:"absolute",pointerEvents:b}),[b]);f.useLayoutEffect(()=>{if(F.current=!1,c){var N;(N=J.current)==null||N.render(f.createElement("div",{ref:q,style:ue},f.createElement("div",{ref:R,style:Jt},f.createElement("div",{ref:T,className:r,style:n,children:e}))))}else{var I;(I=J.current)==null||I.render(f.createElement("div",{ref:T,style:ue,className:r,children:e}))}});const re=f.useRef(!0);ke(N=>{if(D.current){y.updateMatrixWorld(),D.current.updateWorldMatrix(!0,!1);const I=c?G.current:d(D.current,y,C);if(c||Math.abs($.current-y.zoom)>t||Math.abs(G.current[0]-I[0])>t||Math.abs(G.current[1]-I[1])>t){const Q=Or(D.current,y);let X=!1;K&&(Array.isArray(l)?X=l.map(ee=>ee.current):l!=="blending"&&(X=[k]));const fe=re.current;if(X){const ee=Tr(D.current,y,V,X);re.current=ee&&!Q}else re.current=!Q;fe!==re.current&&(m?m(!re.current):_.style.display=re.current?"block":"none");const be=Math.floor(h[0]/2),Kt=l?K?[h[0],be]:[be-1,0]:h;if(_.style.zIndex=`${_r(D.current,y,Kt)}`,c){const[ee,pt]=[C.width/2,C.height/2],Le=y.projectionMatrix.elements[5]*pt,{isOrthographicCamera:vt,top:Qt,left:en,bottom:tn,right:nn}=y,rn=Ir(y.matrixWorldInverse),on=vt?`scale(${Le})translate(${Ye(-(nn+en)/2)}px,${Ye((Qt+tn)/2)}px)`:`translateZ(${Le}px)`;let te=D.current.matrixWorld;p&&(te=y.matrixWorldInverse.clone().transpose().copyPosition(te).scale(D.current.scale),te.elements[3]=te.elements[7]=te.elements[11]=0,te.elements[15]=1),_.style.width=C.width+"px",_.style.height=C.height+"px",_.style.perspective=vt?"":`${Le}px`,q.current&&R.current&&(q.current.style.transform=`${on}${rn}translate(${ee}px,${pt}px)`,R.current.style.transform=Lr(te,1/((i||10)/400)))}else{const ee=i===void 0?1:kr(D.current,y)*i;_.style.transform=`translate3d(${I[0]}px,${I[1]}px,0) scale(${ee})`}G.current=I,$.current=y.zoom}}if(!K&&z.current&&!F.current)if(c){if(q.current){const I=q.current.children[0];if(I!=null&&I.clientWidth&&I!=null&&I.clientHeight){const{isOrthographicCamera:Q}=y;if(Q||w)g.scale&&(Array.isArray(g.scale)?g.scale instanceof Y?z.current.scale.copy(g.scale.clone().divideScalar(1)):z.current.scale.set(1/g.scale[0],1/g.scale[1],1/g.scale[2]):z.current.scale.setScalar(1/g.scale));else{const X=(i||10)/400,fe=I.clientWidth*X,be=I.clientHeight*X;z.current.scale.set(fe,be,1)}F.current=!0}}}else{const I=_.children[0];if(I!=null&&I.clientWidth&&I!=null&&I.clientHeight){const Q=1/A.factor,X=I.clientWidth*Q,fe=I.clientHeight*Q;z.current.scale.set(X,fe,1),F.current=!0}z.current.lookAt(N.camera.position)}});const dt=f.useMemo(()=>({vertexShader:c?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[c]);return f.createElement("group",Te({},g,{ref:D}),l&&!K&&f.createElement("mesh",{castShadow:v,receiveShadow:E,ref:z},w||f.createElement("planeGeometry",null),S||f.createElement("shaderMaterial",{side:yn,vertexShader:dt.vertexShader,fragmentShader:dt.fragmentShader})))});let de=0;const io=Ln(e=>(ye.onStart=(t,n,r)=>{e({active:!0,item:t,loaded:n,total:r,progress:(n-de)/(r-de)*100})},ye.onLoad=()=>{e({active:!1})},ye.onError=t=>e(n=>({errors:[...n.errors,t]})),ye.onProgress=(t,n,r)=>{n===r&&(de=r),e({active:!0,item:t,loaded:n,total:r,progress:(n-de)/(r-de)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));let xe=null,Vt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Xt(e=!0,t=!0,n){return r=>{n&&n(r),e&&(xe||(xe=new An),xe.setDecoderPath(typeof e=="string"?e:Vt),r.setDRACOLoader(xe)),t&&r.setMeshoptDecoder(typeof Fe=="function"?Fe():Fe)}}const it=(e,t,n,r)=>Z(Qe,e,Xt(t,n,r));it.preload=(e,t,n,r)=>Z.preload(Qe,e,Xt(t,n,r));it.clear=e=>Z.clear(Qe,e);it.setDecoderPath=e=>{Vt=e};function Fr(e,t,n){const r=H(v=>v.size),o=H(v=>v.viewport),s=typeof e=="number"?e:r.width*o.dpr,a=r.height*o.dpr,u=(typeof e=="number"?n:e)||{},{samples:i=0,depth:p,...c}=u,l=p??u.depthBuffer,m=f.useMemo(()=>{const v=new wn(s,a,{minFilter:ht,magFilter:ht,type:Tt,...c});return l&&(v.depthTexture=new En(s,a,xn)),v.samples=i,v},[]);return f.useLayoutEffect(()=>{m.setSize(s,a),i&&(m.samples=i)},[i,m,s,a]),f.useEffect(()=>()=>m.dispose(),[]),m}const Dr=e=>typeof e=="function",so=f.forwardRef(({envMap:e,resolution:t=256,frames:n=1/0,makeDefault:r,children:o,...s},a)=>{const u=H(({set:w})=>w),i=H(({camera:w})=>w),p=H(({size:w})=>w),c=f.useRef(null);f.useImperativeHandle(a,()=>c.current,[]);const l=f.useRef(null),m=Fr(t);f.useLayoutEffect(()=>{s.manual||(c.current.aspect=p.width/p.height)},[p,s]),f.useLayoutEffect(()=>{c.current.updateProjectionMatrix()});let v=0,E=null;const S=Dr(o);return ke(w=>{S&&(n===1/0||v<n)&&(l.current.visible=!1,w.gl.setRenderTarget(m),E=w.scene.background,e&&(w.scene.background=e),w.gl.render(w.scene,c.current),w.scene.background=E,w.gl.setRenderTarget(null),l.current.visible=!0,v++)}),f.useLayoutEffect(()=>{if(r){const w=i;return u(()=>({camera:c.current})),()=>u(()=>({camera:w}))}},[c,r,u]),f.createElement(f.Fragment,null,f.createElement("perspectiveCamera",Te({ref:c},s),!S&&o),f.createElement("group",{ref:l},S&&o(m.texture)))}),ao=f.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:r,enableDamping:o=!0,keyEvents:s=!1,onChange:a,onStart:u,onEnd:i,...p},c)=>{const l=H(g=>g.invalidate),m=H(g=>g.camera),v=H(g=>g.gl),E=H(g=>g.events),S=H(g=>g.setEvents),w=H(g=>g.set),h=H(g=>g.get),d=H(g=>g.performance),x=t||m,j=r||E.connected||v.domElement,b=f.useMemo(()=>new Fn(x),[x]);return ke(()=>{b.enabled&&b.update()},-1),f.useEffect(()=>(s&&b.connect(s===!0?j:s),b.connect(j),()=>void b.dispose()),[s,j,n,b,l]),f.useEffect(()=>{const g=y=>{l(),n&&d.regress(),a&&a(y)},T=y=>{u&&u(y)},M=y=>{i&&i(y)};return b.addEventListener("change",g),b.addEventListener("start",T),b.addEventListener("end",M),()=>{b.removeEventListener("start",T),b.removeEventListener("end",M),b.removeEventListener("change",g)}},[a,u,i,b,l,S]),f.useEffect(()=>{if(e){const g=h().controls;return w({controls:b}),()=>w({controls:g})}},[e,b]),f.createElement("primitive",Te({ref:c,object:b,enableDamping:o},p))}),me={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Yt="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",ae=e=>Array.isArray(e),st=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function Ie({files:e=st,path:t="",preset:n=void 0,colorSpace:r=void 0,extensions:o}={}){n&&(at(n),e=me[n],t=Yt);const s=ae(e),{extension:a,isCubemap:u}=ct(e),i=lt(a);if(!i)throw new Error("useEnvironment: Unrecognized file extension: "+e);const p=H(v=>v.gl);f.useLayoutEffect(()=>{if(a!=="webp"&&a!=="jpg"&&a!=="jpeg")return;function v(){Z.clear(i,s?[e]:e)}p.domElement.addEventListener("webglcontextlost",v,{once:!0})},[e,p.domElement]);const c=Z(i,s?[e]:e,v=>{(a==="webp"||a==="jpg"||a==="jpeg")&&v.setRenderer(p),v.setPath==null||v.setPath(t),o&&o(v)});let l=s?c[0]:c;if(a==="jpg"||a==="jpeg"||a==="webp"){var m;l=(m=l.renderTarget)==null?void 0:m.texture}return l.mapping=u?jn:Cn,l.colorSpace=r??(u?"srgb":"srgb-linear"),l}const zr={files:st,path:"",preset:void 0,extensions:void 0};Ie.preload=e=>{const t={...zr,...e};let{files:n,path:r=""}=t;const{preset:o,extensions:s}=t;o&&(at(o),n=me[o],r=Yt);const{extension:a}=ct(n);if(a==="webp"||a==="jpg"||a==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const u=lt(a);if(!u)throw new Error("useEnvironment: Unrecognized file extension: "+n);Z.preload(u,ae(n)?[n]:n,i=>{i.setPath==null||i.setPath(r),s&&s(i)})};const Hr={files:st,preset:void 0};Ie.clear=e=>{const t={...Hr,...e};let{files:n}=t;const{preset:r}=t;r&&(at(r),n=me[r]);const{extension:o}=ct(n),s=lt(o);if(!s)throw new Error("useEnvironment: Unrecognized file extension: "+n);Z.clear(s,ae(n)?[n]:n)};function at(e){if(!(e in me))throw new Error("Preset must be one of: "+Object.keys(me).join(", "))}function ct(e){var t;const n=ae(e)&&e.length===6,r=ae(e)&&e.length===3&&e.some(a=>a.endsWith("json")),o=ae(e)?e[0]:e;return{extension:n?"cube":r?"webp":o.startsWith("data:application/exr")?"exr":o.startsWith("data:application/hdr")?"hdr":o.startsWith("data:image/jpeg")?"jpg":(t=o.split(".").pop())==null||(t=t.split("?"))==null||(t=t.shift())==null?void 0:t.toLowerCase(),isCubemap:n,isGainmap:r}}function lt(e){return e==="cube"?Pn:e==="hdr"?Dn:e==="exr"?zn:e==="jpg"||e==="jpeg"?Wn:e==="webp"?Bn:null}const Wr=e=>e.current&&e.current.isScene,Br=e=>Wr(e)?e.current:e;function ut(e,t,n,r,o={}){var s,a,u,i;o={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...o};const p=Br(t||n),c=p.background,l=p.environment,m={backgroundBlurriness:p.backgroundBlurriness,backgroundIntensity:p.backgroundIntensity,backgroundRotation:(s=(a=p.backgroundRotation)==null||a.clone==null?void 0:a.clone())!==null&&s!==void 0?s:[0,0,0],environmentIntensity:p.environmentIntensity,environmentRotation:(u=(i=p.environmentRotation)==null||i.clone==null?void 0:i.clone())!==null&&u!==void 0?u:[0,0,0]};return e!=="only"&&(p.environment=r),e&&(p.background=r),U(p,o),()=>{e!=="only"&&(p.environment=l),e&&(p.background=c),U(p,m)}}function ft({scene:e,background:t=!1,map:n,...r}){const o=H(s=>s.scene);return f.useLayoutEffect(()=>{if(n)return ut(t,e,o,n,r)}),null}function Zt({background:e=!1,scene:t,blur:n,backgroundBlurriness:r,backgroundIntensity:o,backgroundRotation:s,environmentIntensity:a,environmentRotation:u,...i}){const p=Ie(i),c=H(l=>l.scene);return f.useLayoutEffect(()=>ut(e,t,c,p,{backgroundBlurriness:n??r,backgroundIntensity:o,backgroundRotation:s,environmentIntensity:a,environmentRotation:u})),f.useEffect(()=>()=>{p.dispose()},[p]),null}function Gr({children:e,near:t=.1,far:n=1e3,resolution:r=256,frames:o=1,map:s,background:a=!1,blur:u,backgroundBlurriness:i,backgroundIntensity:p,backgroundRotation:c,environmentIntensity:l,environmentRotation:m,scene:v,files:E,path:S,preset:w=void 0,extensions:h}){const d=H(M=>M.gl),x=H(M=>M.scene),j=f.useRef(null),[b]=f.useState(()=>new Rt),g=f.useMemo(()=>{const M=new Mn(r);return M.texture.type=Tt,M},[r]);f.useEffect(()=>()=>{g.dispose()},[g]),f.useLayoutEffect(()=>{if(o===1){const M=d.autoClear;d.autoClear=!0,j.current.update(d,b),d.autoClear=M}return ut(a,v,x,g.texture,{backgroundBlurriness:u??i,backgroundIntensity:p,backgroundRotation:c,environmentIntensity:l,environmentRotation:m})},[e,b,g.texture,v,x,a,o,d]);let T=1;return ke(()=>{if(o===1/0||T<o){const M=d.autoClear;d.autoClear=!0,j.current.update(d,b),d.autoClear=M,T++}}),f.createElement(f.Fragment,null,wr(f.createElement(f.Fragment,null,e,f.createElement("cubeCamera",{ref:j,args:[t,n,g]}),E||w?f.createElement(Zt,{background:!0,files:E,preset:w,path:S,extensions:h}):s?f.createElement(ft,{background:!0,map:s,extensions:h}):null),b))}function Nr(e){var t,n,r,o;const s=Ie(e),a=e.map||s;f.useMemo(()=>Wt({GroundProjectedEnvImpl:Hn}),[]),f.useEffect(()=>()=>{s.dispose()},[s]);const u=f.useMemo(()=>[a],[a]),i=(t=e.ground)==null?void 0:t.height,p=(n=e.ground)==null?void 0:n.radius,c=(r=(o=e.ground)==null?void 0:o.scale)!==null&&r!==void 0?r:1e3;return f.createElement(f.Fragment,null,f.createElement(ft,Te({},e,{map:a})),f.createElement("groundProjectedEnvImpl",{args:u,scale:c,height:i,radius:p}))}function co(e){return e.ground?f.createElement(Nr,e):e.map?f.createElement(ft,e):e.children?f.createElement(Gr,e):f.createElement(Zt,e)}export{ro as C,co as E,oo as H,ao as O,so as P,io as a,ke as b,it as u};
